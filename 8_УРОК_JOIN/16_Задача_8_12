### Задача 12.

---

А что если бы мы захотели сделать более подробную аналитику и, например, посчитать среднюю стоимость заказа (средний чек) каждого клиента? Для этого нам бы уже потребовалась информация о стоимости каждого отдельного заказа. Давайте проведём такие расчёты.

---

**Задание:**

Для начала к таблице с заказами (`orders`) примените функцию `unnest`, как мы делали [в прошлом уроке](https://lab.karpov.courses/learning/152/module/1762/lesson/17928/53213/257135/). Колонку с id товаров назовите `product_id`. Затем к образовавшейся расширенной таблице по ключу `product_id` добавьте информацию о ценах на товары (из таблицы `products`). Должна получиться таблица с заказами, товарами внутри каждого заказа и ценами на эти товары. Выведите колонки с id заказа, id товара и ценой товара. Результат отсортируйте сначала по возрастанию id заказа, затем по возрастанию id товара.

Добавьте в запрос оператор `LIMIT` и выведите только первые 1000 строк результирующей таблицы.

Поля в результирующей таблице: `order_id`, `product_id`, `price`

---

 **Ожидаемый результат**

|order_id|product_id|price|
|---|---|---|
|1|28|75.0|
|1|65|100.0|
|2|30|140.0|
|2|34|98.0|
|2|35|90.0|
|...|...|...|
|150|45|78.0|
|150|64|200.0|
|150|72|66.0|
|150|84|90.0|
|151|7|351.0|
|...|...|...|
|299|83|55.0|
|299|87|398.0|
|300|57|450.0|
|300|67|30.0|
|301|1|150.0|

Affected rows: 1000

---

# Решения:

**Мое решение и решение Автора совпадают:** 

	SELECT 
	    order_id, 
	    product_id,
	    price
	    
	FROM 	
	    (SELECT order_id, product_ids, unnest (product_ids) AS product_id FROM orders) b
	    
	    LEFT JOIN 
	    
	    products 
	    
	    USING (product_id)
	    
	ORDER BY order_id, product_id 
	LIMIT 1000
